<!-- Rating Modal -->
<div class="fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center z-[9999] p-4"
     (click)="closeModal()">
  <div class="bg-white rounded-lg max-w-md w-full overflow-hidden shadow-2xl transform transition-all border-2 border-black"
       (click)="$event.stopPropagation()">
    
    <!-- Modal Header -->
    <div class="flex items-center justify-between p-4 border-b-2 border-black bg-black">
      <div class="flex items-center gap-2">
        <div class="p-1.5 bg-white rounded-lg">
          <svg class="w-5 h-5 text-black" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
        </div>
        <h2 class="text-lg font-bold text-white">Rate Your Experience</h2>
      </div>
      <button 
        (click)="closeModal()"
        class="text-white hover:text-gray-300 transition-colors p-1.5 hover:bg-white/10 rounded-lg">
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
      </button>
    </div>

    <!-- Modal Content -->
    <div class="p-6">
      <!-- User Info -->
      <div *ngIf="ratedUser" class="mb-6">
        <div class="flex items-center gap-3 p-3 bg-gray-100 rounded-lg border border-black">
          <img 
            [src]="getUserAvatarUrl(ratedUser.profile_image, ratedUser.full_name)" 
            class="w-12 h-12 rounded-full border-2 border-black"
            alt="User avatar">
          <div class="flex-1">
            <h3 class="font-semibold text-black">Rating {{ ratedUser.full_name }}</h3>
            <p class="text-sm text-gray-600" *ngIf="productName">{{ productName }}</p>
          </div>
        </div>
      </div>

      <!-- Rating Questions -->
      <div class="space-y-6">
        
        <!-- Communication Rating -->
        <div>
          <h4 class="font-medium text-black mb-2">Communication with Seller</h4>
            <p class="text-sm text-gray-700 mb-3">How satisfied were you with the communication and responsiveness during the transaction?</p>
            <div class="flex items-center gap-1">
              <button 
                *ngFor="let star of [1,2,3,4,5]; let i = index"
                (click)="setCommunicationRating(star)"
                class="w-8 h-8 transition-colors hover:scale-110 transform">
                <svg 
                  class="w-full h-full"
                  [class.text-black]="star <= communicationRating"
                  [class.text-gray-400]="star > communicationRating"
                  fill="currentColor" 
                  viewBox="0 0 24 24">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
              </svg>
            </button>
            <span class="ml-2 text-sm text-gray-700 font-medium">{{ getRatingText(communicationRating) }}</span>
          </div>
        </div>

        <!-- Product Quality Rating -->
        <div>
          <h4 class="font-medium text-black mb-2">Product Quality or Condition</h4>
          <p class="text-sm text-gray-700 mb-3">How accurate was the product compared to its description and photos?</p>
          <div class="flex items-center gap-1">
            <button 
              *ngFor="let star of [1,2,3,4,5]; let i = index"
              (click)="setProductRating(star)"
              class="w-8 h-8 transition-colors hover:scale-110 transform">
              <svg 
                class="w-full h-full"
                [class.text-black]="star <= productRating"
                [class.text-gray-400]="star > productRating"
                fill="currentColor" 
                viewBox="0 0 24 24">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
              </svg>
            </button>
            <span class="ml-2 text-sm text-gray-700 font-medium">{{ getRatingText(productRating) }}</span>
          </div>
        </div>

        <!-- App Experience Rating -->
        <div>
          <h4 class="font-medium text-black mb-2">App Experience</h4>
          <p class="text-sm text-gray-700 mb-3">How helpful and easy to use was the CycleMart app during your transaction?</p>
          <div class="flex items-center gap-1">
            <button 
              *ngFor="let star of [1,2,3,4,5]; let i = index"
              (click)="setAppRating(star)"
              class="w-8 h-8 transition-colors hover:scale-110 transform">
              <svg 
                class="w-full h-full"
                [class.text-black]="star <= appRating"
                [class.text-gray-400]="star > appRating"
                fill="currentColor" 
                viewBox="0 0 24 24">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
              </svg>
            </button>
            <span class="ml-2 text-sm text-gray-700 font-medium">{{ getRatingText(appRating) }}</span>
          </div>
        </div>

        <!-- Feedback (Optional) -->
        <div>
          <h4 class="font-medium text-black mb-2">Additional Feedback (Optional)</h4>
          <textarea 
            [(ngModel)]="feedback"
            placeholder="Share your experience or any additional comments..."
            rows="3"
            class="w-full p-3 border-2 border-black rounded-lg focus:outline-none focus:ring-2 focus:ring-black focus:border-black resize-none text-black placeholder-gray-600">
          </textarea>
        </div>
      </div>

      <!-- Modal Actions -->
      <div class="flex flex-col sm:flex-row gap-3 sm:gap-4 mt-6">
        <button 
          (click)="closeModal()"
          class="flex-1 bg-white hover:bg-gray-100 text-black border-2 border-black px-6 py-3 rounded-lg transition-all duration-200 font-semibold text-center">
          Cancel
        </button>
        <button 
          (click)="submitRating()"
          [disabled]="!isFormValid()"
          class="flex-1 bg-black hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed text-white px-6 py-3 rounded-lg transition-all duration-200 font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 text-center">
          Submit Rating
        </button>
      </div>
    </div>
  </div>
</div>
