<div class="flex h-screen bg-white">
  <!-- Sidenav -->
  <app-sidenav></app-sidenav>

  <!-- Page content -->
  <div class="flex-1 p-4 md:p-6 bg-white overflow-y-auto">
    
   

    <!-- Enhanced Combined Header & Search Section -->
    <div class="mb-5">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-3">
        <!-- Left: Title and Description -->
        <div class="flex-1">
          <h1 class="text-xl md:text-2xl font-bold text-gray-900 mb-1">Discover Bike Parts</h1>
          <p class="text-gray-600 text-sm">Find the perfect components for your cycling adventures</p>
        </div>
        
        <!-- Right: Search Bar and Updated Info -->
        <div class="flex flex-col md:flex-row items-stretch md:items-center gap-3 md:gap-4">
          <!-- Enhanced Search Bar -->
          <div class="relative flex-1 md:w-[1152px]">
            <div class="flex gap-2 p-3 bg-white rounded-lg shadow-md border border-gray-300">
              <div class="flex-1 relative">
                <input 
                  type="text" 
                  [(ngModel)]="searchQuery"
                  (input)="onSearchInputChange()"
                  (keyup.enter)="performSearch()"
                  placeholder="Search bike parts, brands, or categories..."
                  class="w-full px-4 py-2 text-black bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent placeholder-gray-500"
                />
                <div *ngIf="searchQuery" class="absolute right-2 top-1/2 transform -translate-y-1/2">
                  <button 
                    (click)="clearSearch()"
                    class="text-gray-400 hover:text-black transition-colors">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                  </button>
                </div>
              </div>
              <button 
                (click)="performSearch()"
                class="px-4 py-2 bg-black text-white rounded-lg hover:bg-gray-800 transition-colors font-medium flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                </svg>
                Search
              </button>
            </div>
          </div>
          
         
        </div>
      </div>
    </div>

  

    <!-- Compact Quick Filter Tags -->
    <div *ngIf="!loading" class="mb-6">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg font-semibold text-black">Popular Categories</h2>
        
        <!-- Mobile Dropdown (visible on small screens) -->
        <div class="md:hidden relative">
          <select 
            (change)="onMobileFilterChange($event)"
            class="bg-white border border-gray-300 rounded-xl px-4 py-2 text-sm focus:ring-2 focus:ring-black focus:border-transparent shadow-sm hover:border-gray-400 transition-colors min-w-[140px] text-black">
            <option value="">Select Category</option>
            <option value="whole bike">Whole Bike</option>
            <option value="bike_parts">Bike Parts</option>
            <option value="accessories">Accessories</option>
            <option value="for sale">For Sale</option>
            <option value="for trade">For Trade</option>
            <option value="brand new">Brand New</option>
            <option value="giant">Giant</option>
            <option value="trek">Trek</option>
          </select>
        </div>
        
        <!-- Desktop View All Button (hidden on small screens) -->
        <button class="hidden md:flex text-black hover:text-gray-600 text-xs font-medium items-center gap-1">
          View All
          <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
          </svg>
        </button>
      </div>
      
      <!-- Desktop Filter Buttons (hidden on small screens) -->
      <div class="hidden md:flex flex-wrap gap-2">
        <button 
          (click)="quickSearch('whole bike')"
          class="group px-4 py-2 bg-white text-black rounded-xl text-xs font-medium hover:bg-gray-100 transition-all duration-300 transform hover:-translate-y-1 hover:shadow-lg flex items-center gap-1.5 border border-gray-300">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
          </svg>
          Whole Bike
        </button>
        <button 
          (click)="quickSearch('bike parts')"
          class="group px-4 py-2 bg-white text-black rounded-xl text-xs font-medium hover:bg-gray-100 transition-all duration-300 transform hover:-translate-y-1 hover:shadow-lg flex items-center gap-1.5 border border-gray-300">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
          </svg>
          Bike Parts
        </button>
        <button 
          (click)="quickSearch('accessories')"
          class="group px-4 py-2 bg-white text-black rounded-xl text-xs font-medium hover:bg-gray-100 transition-all duration-300 transform hover:-translate-y-1 hover:shadow-lg flex items-center gap-1.5 border border-gray-300">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
          </svg>
          Accessories
        </button>
        <button 
          (click)="quickSearch('for sale')"
          class="group px-4 py-2 bg-white text-black rounded-xl text-xs font-medium hover:bg-gray-100 transition-all duration-300 transform hover:-translate-y-1 hover:shadow-lg flex items-center gap-1.5 border border-gray-300">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"/>
          </svg>
          For Sale
        </button>
        <button 
          (click)="quickSearch('for trade')"
          class="group px-4 py-2 bg-white text-black rounded-xl text-xs font-medium hover:bg-gray-100 transition-all duration-300 transform hover:-translate-y-1 hover:shadow-lg flex items-center gap-1.5 border border-gray-300">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"/>
          </svg>
          For Trade
        </button>
        <button 
          (click)="quickSearch('brand new')"
          class="group px-4 py-2 bg-white text-black rounded-xl text-xs font-medium hover:bg-gray-100 transition-all duration-300 transform hover:-translate-y-1 hover:shadow-lg flex items-center gap-1.5 border border-gray-300">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
          </svg>
          Brand New
        </button>
        <button 
          (click)="quickSearch('giant')"
          class="group px-4 py-2 bg-white text-black rounded-xl text-xs font-medium hover:bg-gray-100 transition-all duration-300 transform hover:-translate-y-1 hover:shadow-lg flex items-center gap-1.5 border border-gray-300">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
          </svg>
          Giant
        </button>
        <button 
          (click)="quickSearch('trek')"
          class="group px-4 py-2 bg-white text-black rounded-xl text-xs font-medium hover:bg-gray-100 transition-all duration-300 transform hover:-translate-y-1 hover:shadow-lg flex items-center gap-1.5 border border-gray-300">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
          </svg>
          Trek
        </button>
      </div>
    </div>

    <!-- Enhanced Search Results Info -->
    <div *ngIf="searchQuery && !loading" class="mb-6 p-4 bg-white border border-gray-300 rounded-2xl">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div class="p-2 bg-gray-100 rounded-lg">
            <svg class="w-5 h-5 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
            </svg>
          </div>
          <div>
            <span class="text-black font-semibold text-lg">
              {{filteredItems.length}} result{{filteredItems.length !== 1 ? 's' : ''}} found
            </span>
            <p class="text-gray-600 text-sm">for "{{searchQuery}}"</p>
          </div>
        </div>
        <button 
          (click)="clearSearch()"
          class="bg-black hover:bg-gray-800 text-white px-4 py-2 rounded-xl text-sm font-medium transition-colors flex items-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
          Clear search
        </button>
      </div>
    </div>

    <!-- Enhanced Loading state -->
    <div *ngIf="loading" class="flex justify-center items-center h-64">
      <div class="text-center">
        <div class="relative">
          <div class="animate-spin rounded-full h-16 w-16 border-4 border-gray-200 border-t-black mx-auto mb-4"></div>
          <div class="absolute inset-0 flex items-center justify-center">
            <svg class="w-6 h-6 text-black animate-pulse" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
            </svg>
          </div>
        </div>
        <p class="text-gray-600 font-medium">Discovering amazing bike parts...</p>
        <p class="text-gray-500 text-sm mt-1">This won't take long</p>
      </div>
    </div>

    <!-- Enhanced Error state -->
    <div *ngIf="error && !loading" class="bg-white border-2 border-gray-300 text-black px-6 py-5 rounded-2xl mb-6">
      <div class="flex items-start gap-4">
        <div class="p-2 bg-gray-100 rounded-lg">
          <svg class="w-6 h-6 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"/>
          </svg>
        </div>
        <div class="flex-1">
          <div class="font-semibold text-lg mb-1">Oops! Something went wrong</div>
          <div class="text-gray-600">{{ error }}</div>
          <button 
            (click)="loadActiveProducts()" 
            class="mt-3 bg-black text-white px-6 py-2 rounded-xl hover:bg-gray-800 transition-colors font-medium flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
            </svg>
            Try Again
          </button>
        </div>
      </div>
    </div>

    <!-- Enhanced No products message -->
    <div *ngIf="!loading && !error && filteredItems.length === 0 && !searchQuery" class="text-center py-16">
      <div class="mb-8">
        <div class="relative inline-block">
          <div class="text-8xl animate-bounce">üö¥‚Äç‚ôÇÔ∏è</div>
          <div class="absolute -top-2 -right-2 text-3xl animate-pulse">‚ú®</div>
        </div>
      </div>
      <h3 class="text-3xl font-bold text-black mb-4">No Products Available Yet</h3>
      <p class="text-gray-600 text-lg mb-6 max-w-md mx-auto">
        Our marketplace is getting ready! Check back soon for amazing bike parts and accessories.
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <button 
          (click)="loadActiveProducts()"
          class="bg-black text-white px-8 py-3 rounded-xl hover:bg-gray-800 transition-all duration-200 font-semibold shadow-lg">
          Refresh Products
        </button>
        <button class="bg-gray-200 text-gray-800 px-8 py-3 rounded-xl hover:bg-gray-300 transition-colors font-semibold">
          Browse Categories
        </button>
      </div>
    </div>

    <!-- Enhanced No search results message -->
    <div *ngIf="!loading && !error && filteredItems.length === 0 && searchQuery" class="text-center py-16">
      <div class="mb-8">
        <div class="relative inline-block">
          <div class="text-8xl">üîç</div>
          <div class="absolute -bottom-2 -right-2 text-4xl animate-ping opacity-75">‚ùå</div>
        </div>
      </div>
      <h3 class="text-3xl font-bold text-black mb-4">No Results Found</h3>
      <p class="text-gray-600 text-lg mb-2">We couldn't find any products matching</p>
      <p class="text-black font-semibold text-xl mb-6">"{{searchQuery}}"</p>
      <div class="bg-gray-50 rounded-2xl p-6 max-w-md mx-auto mb-6 border border-gray-300">
        <h4 class="font-semibold text-black mb-3">Try searching for:</h4>
        <ul class="text-gray-600 text-sm space-y-1">
          <li>‚Ä¢ Different keywords or synonyms</li>
          <li>‚Ä¢ Broader category names</li>
          <li>‚Ä¢ Brand names or part numbers</li>
          <li>‚Ä¢ General terms like "bike" or "parts"</li>
        </ul>
      </div>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <button 
          (click)="clearSearch()"
          class="bg-black text-white px-8 py-3 rounded-xl hover:bg-gray-800 transition-all duration-200 font-semibold shadow-lg">
          Clear Search
        </button>
    
      </div>
    </div>

    <!-- Enhanced Product Grid -->
    <div *ngIf="!loading && !error && filteredItems.length > 0">
      <!-- Results header -->
      <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6">
        <div>
          <h2 class="text-2xl font-bold text-black">
            {{searchQuery ? 'Search Results' : 'Featured Products'}}
          </h2>
          <p class="text-gray-600 text-sm mt-1">{{filteredItems.length}} items available</p>
        </div>
        <div class="flex items-center gap-4">
          <div class="flex items-center gap-2">
            <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4h13M3 8h9m-9 4h9m5-4v12m0 0l-4-4m4 4l4-4"/>
            </svg>
            <label class="text-sm font-medium text-gray-700">Sort by:</label>
          </div>
          <select 
            [(ngModel)]="currentSortOption"
            (change)="onSortChange($event)"
            class="border border-gray-300 rounded-xl px-4 py-2 text-sm focus:ring-2 focus:ring-black focus:border-transparent bg-white shadow-sm hover:border-gray-400 transition-colors min-w-[180px]">
            <option value="featured">Featured</option>
            <option value="price-low-high">Price: Low to High</option>
            <option value="price-high-low">Price: High to Low</option>
            <option value="newest">Newest First</option>
            <option value="oldest">Oldest First</option>
            <option value="name-a-z">Name: A to Z</option>
            <option value="name-z-a">Name: Z to A</option>
            <option value="brand-a-z">Brand: A to Z</option>
            <option value="rating">Highest Rated</option>
          </select>
        </div>
      </div>
      
      <!-- Product Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-6">
        <div
          *ngFor="let item of filteredItems"
          (click)="onProductCardClick(item, $event)"
          class="group bg-white rounded-2xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300 border border-gray-300 hover:border-gray-400 transform hover:-translate-y-2 hover:scale-[1.02] cursor-pointer active:scale-[0.98] active:shadow-lg"
        >
          <!-- Image Section -->
          <div class="relative aspect-square bg-white overflow-hidden"
               (click)="openProductModal(item)">
            <img 
              [src]="item.image" 
              [alt]="item.product_name" 
              class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"
              (error)="onImageError($event, item)"
              (load)="onImageLoad($event, item)" />
            
            <!-- Hover overlay -->
            <!-- <div class="absolute inset-0 bg-gradient-to-t from-black/20 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 z-0"></div>
             -->
            <!-- Quick view button -->
            <!-- <div class="absolute inset-0 opacity-0 group-hover:opacity-100 transition-all duration-300 z-20">
              <button 
                (click)="openProductModal(item); $event.stopPropagation()"
                class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-black text-white px-6 py-3 rounded-full font-medium hover:bg-gray-800 transition-all duration-200 shadow-xl border-2 border-white">
                <span class="flex items-center gap-2">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                  </svg>
                  Quick View
                </span>
              </button>
            </div> -->

            <!-- Sale type badge -->
            <div class="absolute top-3 left-3">
              <span [ngClass]="getSaleTypeBadgeClass(item.saleType)" class="text-white text-xs px-3 py-1 rounded-full font-semibold shadow-lg">
                {{ item.saleType }}
              </span>
            </div>

            <!-- Video indicator badge -->
            <div *ngIf="item.productVideos && item.productVideos.length > 0" class="absolute top-3 right-3">
              <span class="bg-purple-500 text-white text-xs px-3 py-1 rounded-full font-semibold shadow-lg flex items-center gap-1">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                </svg>
                {{ item.productVideos.length }}
              </span>
            </div>
          </div>

          <!-- Content Section -->
          <div class="p-5">
            <!-- Product Name and Brand -->
            <h3 class="text-lg font-bold text-black mb-2 line-clamp-2 group-hover:text-gray-600 transition-colors duration-200 cursor-pointer" 
                [title]="item.product_name"
                (click)="testProductClick(item, $event)">
              {{ item.product_name }}
            </h3>

            <!-- Brand Badge -->
            <div class="mb-3">
              <span class="bg-gray-100 text-gray-700 text-xs px-3 py-1 rounded-full font-medium">
                {{ item.brand_display }}
              </span>
            </div>

            <!-- Price -->
            <div class="mb-3">
              <p class="text-2xl font-bold text-black">‚Ç±{{ item.price | number }}</p>
            </div>

            <!-- Category -->
            <div class="mb-4">
              <span class="bg-gray-100 text-gray-700 text-xs px-3 py-1 rounded-full font-medium">{{ item.category }}</span>
            </div>

            <!-- Seller Information -->
            <div class="space-y-2 mb-4">
              <div class="flex items-center text-sm text-gray-600 cursor-pointer hover:text-gray-800 transition-colors"
                   (click)="openProfileModal(item); $event.stopPropagation()">
                <img 
                  [src]="getProfileImageUrl(item.seller_profile_image, item.seller)" 
                  [alt]="item.seller + ' profile'"
                  class="w-6 h-6 rounded-full object-cover border border-gray-200 mr-2 shadow-sm hover:border-gray-400 transition-colors"
                  (error)="$any($event.target).src = getProfileImageUrl(null, item.seller)"
                />
                <span class="font-medium hover:underline">{{ item.seller }}</span>
              </div>
              <div class="flex items-center text-sm text-gray-600">
                <svg class="w-4 h-4 mr-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                </svg>
                <span>{{ item.location }}</span>
              </div>
            </div>

            <!-- Actions Section -->
            <div class="flex items-center justify-between">
              <!-- Enhanced Rating Display with Visual Stars -->
              <div class="flex flex-col space-y-1">
                <!-- Star Rating -->
                <div class="flex items-center gap-1">
                  <!-- Visual Stars -->
                  <div class="flex items-center" *ngIf="item.rating > 0">
                    <ng-container *ngFor="let star of getStarArray(item.rating)">
                      <!-- Full Star -->
                      <svg *ngIf="star.type === 'full'" class="w-4 h-4 text-yellow-400" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                      </svg>
                      <!-- Half Star -->
                      <div *ngIf="star.type === 'half'" class="relative w-4 h-4">
                        <svg class="absolute w-4 h-4 text-gray-300" fill="currentColor" viewBox="0 0 24 24">
                          <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                        </svg>
                        <svg class="absolute w-4 h-4 text-yellow-400" fill="currentColor" viewBox="0 0 24 24" style="clip-path: inset(0 50% 0 0);">
                          <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                        </svg>
                      </div>
                      <!-- Empty Star -->
                      <svg *ngIf="star.type === 'empty'" class="w-4 h-4 text-gray-300" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                      </svg>
                    </ng-container>
                  </div>
                  
                  <!-- No Rating Display -->
                  <div class="flex items-center text-gray-400" *ngIf="item.rating === 0">
                    <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                    </svg>
                    <span class="text-xs">No ratings</span>
                  </div>
                  
                  <!-- Rating Value -->
                  <span *ngIf="item.rating > 0" [ngClass]="getRatingColorClass(item.rating)" class="text-sm font-medium ml-1">
                    {{ item.rating | number:'1.1-1' }}
                  </span>
                </div>
                
                <!-- Review Count and Description -->
                <div class="flex flex-col" *ngIf="item.rating > 0">
                  <div class="text-xs text-gray-500">
                    {{ item.totalRatings || 0 }} review{{ (item.totalRatings || 0) !== 1 ? 's' : '' }}
                  </div>
                  <div class="text-xs" [ngClass]="getRatingColorClass(item.rating)">
                    {{ getRatingText(item.rating, item.totalRatings || 0) }}
                  </div>
                </div>
              </div>
              
              <div class="flex items-center space-x-2">
                <!-- Message Icon -->
                <button 
                  (click)="contactSeller(item); $event.stopPropagation()"
                  (mouseenter)="showTooltip('message-' + item.id)"
                  (mouseleave)="hideTooltip()"
                  (dblclick)="toggleTooltip('message-' + item.id, $event)"
                  class="p-2 bg-black hover:bg-gray-800 text-white rounded-full transition-all duration-200 hover:scale-110 shadow-lg group relative"
                  title="Message seller">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                          d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                  </svg>
                  <!-- Enhanced Tooltip -->
                  <div 
                    [class]="'absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg whitespace-nowrap transition-all duration-300 z-50 ' + 
                             (isTooltipActive('message-' + item.id) ? 'opacity-100 visible scale-100' : 'opacity-0 invisible scale-95')">
                    <div class="flex flex-col items-center gap-1">
                      <div class="flex items-center gap-2">
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                        </svg>
                        <span>Message seller</span>
                      </div>
                      <span class="text-gray-300 text-xs">Product details included</span>
                    </div>
                    <!-- Tooltip arrow -->
                    <div class="absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"></div>
                  </div>
                </button>

                <!-- Report Icon -->
                <button 
                  (click)="openReportModal(item, $event)"
                  (mouseenter)="showTooltip('report-' + item.id)"
                  (mouseleave)="hideTooltip()"
                  (dblclick)="toggleTooltip('report-' + item.id, $event)"
                  class="p-2 bg-gray-600 hover:bg-gray-700 text-white rounded-full transition-all duration-200 hover:scale-110 shadow-lg group relative"
                  title="Report this product">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                          d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.268 18.5c-.77.833.192 2.5 1.732 2.5z"/>
                  </svg>
                  <!-- Enhanced Tooltip -->
                  <div 
                    [class]="'absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg whitespace-nowrap transition-all duration-300 z-50 ' + 
                             (isTooltipActive('report-' + item.id) ? 'opacity-100 visible scale-100' : 'opacity-0 invisible scale-95')">
                    <div class="flex items-center gap-2">
                      <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                              d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.268 18.5c-.77.833.192 2.5 1.732 2.5z"/>
                      </svg>
                      <span>Report product</span>
                    </div>
                    <!-- Tooltip arrow -->
                    <div class="absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"></div>
                  </div>
                </button>
                
                <!-- View Details Button -->
                <button 
                  (click)="openProductModal(item); $event.stopPropagation()"
                  class="text-[#6BA3BE] hover:text-[#5a92a5] font-medium text-sm transition-colors duration-200 hover:underline">
                  View Details ‚Üí
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  <!-- Enhanced Product Detail Modal -->
  <div *ngIf="showModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4"
       (click)="closeModal()">
    <div class="bg-white rounded-3xl max-w-7xl w-full max-h-[95vh] overflow-hidden shadow-2xl"
         (click)="$event.stopPropagation()">
      
      <!-- Enhanced Modal Header -->
      <div class="flex items-center justify-between p-6 border-b border-gray-300 bg-black">
        <div class="flex items-center gap-3">
          <div class="p-2 bg-white/20 rounded-lg">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
            </svg>
          </div>
          <h2 class="text-2xl font-bold text-white">Product Details</h2>
        </div>
        <button 
          (click)="closeModal()"
          class="text-white/80 hover:text-white transition-colors p-2 hover:bg-white/10 rounded-lg">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>

      <!-- Enhanced Modal Content -->
      <div *ngIf="selectedProduct" class="p-6 overflow-y-auto max-h-[calc(95vh-120px)]">
        <div class="grid grid-cols-1 xl:grid-cols-2 gap-8">
          
          <!-- Enhanced Product Media Section (Images & Videos) -->
          <div class="space-y-6">
            <!-- Media Type Tabs -->
            <div *ngIf="selectedProduct.productImages?.length > 0 || selectedProduct.productVideos?.length > 0" 
                 class="flex gap-1 bg-gray-100 p-1 rounded-xl">
              <button 
                *ngIf="selectedProduct.productImages?.length > 0"
                (click)="switchToImages()"
                [class.bg-white]="currentMediaType === 'image'"
                [class.shadow-sm]="currentMediaType === 'image'"
                [class.text-black]="currentMediaType === 'image'"
                [class.text-gray-600]="currentMediaType !== 'image'"
                class="flex-1 px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center justify-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                </svg>
                Images ({{selectedProduct.productImages?.length || 0}})
              </button>
              <button 
                *ngIf="selectedProduct.productVideos?.length > 0"
                (click)="switchToVideos()"
                [class.bg-white]="currentMediaType === 'video'"
                [class.shadow-sm]="currentMediaType === 'video'"
                [class.text-black]="currentMediaType === 'video'"
                [class.text-gray-600]="currentMediaType !== 'video'"
                class="flex-1 px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center justify-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                </svg>
                Videos ({{selectedProduct.productVideos?.length || 0}})
              </button>
            </div>

            <!-- Image Display -->
            <div *ngIf="currentMediaType === 'image' && selectedProduct.productImages?.length > 0" class="space-y-6">
              <!-- Main Image -->
              <div class="relative aspect-square bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl overflow-hidden shadow-lg">
                <img 
                  [src]="getCurrentImageUrl()" 
                  [alt]="selectedProduct.product_name"
                  class="w-full h-full object-contain p-4">
                
                <!-- Navigation Arrows -->
                <button 
                  *ngIf="selectedProduct.productImages && selectedProduct.productImages.length > 1"
                  (click)="prevImage()"
                  class="absolute left-4 top-1/2 transform -translate-y-1/2 bg-white/90 backdrop-blur-sm text-gray-700 rounded-full w-12 h-12 flex items-center justify-center hover:bg-white hover:scale-110 transition-all duration-200 shadow-lg">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                  </svg>
                </button>
                
                <button 
                  *ngIf="selectedProduct.productImages && selectedProduct.productImages.length > 1"
                  (click)="nextImage()"
                  class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-white/90 backdrop-blur-sm text-gray-700 rounded-full w-12 h-12 flex items-center justify-center hover:bg-white hover:scale-110 transition-all duration-200 shadow-lg">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                  </svg>
                </button>

                <!-- Enhanced Image Counter -->
                <div *ngIf="selectedProduct.productImages && selectedProduct.productImages.length > 1" 
                     class="absolute bottom-4 right-4 bg-black/70 backdrop-blur-sm text-white px-4 py-2 rounded-full text-sm font-medium">
                  {{currentImageIndex + 1}} / {{selectedProduct.productImages.length}}
                </div>

                <!-- Zoom indicator -->
                <div class="absolute top-4 right-4 bg-white/90 backdrop-blur-sm text-gray-700 px-3 py-1 rounded-full text-xs font-medium">
                  Click to zoom
                </div>
              </div>

              <!-- Enhanced Thumbnail Strip -->
              <div *ngIf="selectedProduct.productImages && selectedProduct.productImages.length > 1" 
                   class="flex gap-3 overflow-x-auto pb-2">
                <button 
                  *ngFor="let image of selectedProduct.productImages; let i = index"
                  (click)="goToImage(i)"
                  [class.ring-4]="currentImageIndex === i"
                  [class.ring-[#6BA3BE]]="currentImageIndex === i"
                  [class.scale-110]="currentImageIndex === i"
                  class="flex-shrink-0 w-20 h-20 rounded-xl overflow-hidden border-2 border-transparent hover:border-gray-300 transition-all duration-200 shadow-md hover:shadow-lg">
                  <img [src]="getImageUrl(image)" class="w-full h-full object-cover">
                </button>
              </div>
            </div>

            <!-- Video Display -->
            <div *ngIf="currentMediaType === 'video' && selectedProduct.productVideos?.length > 0" class="space-y-6">
              <!-- Main Video -->
              <div class="relative aspect-video bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl overflow-hidden shadow-lg">
                <video 
                  [src]="getCurrentVideoUrl()" 
                  class="w-full h-full object-contain"
                  controls
                  preload="metadata"
                  poster="">
                  Your browser does not support the video tag.
                </video>
                
                <!-- Video Navigation Arrows -->
                <button 
                  *ngIf="selectedProduct.productVideos && selectedProduct.productVideos.length > 1"
                  (click)="prevVideo()"
                  class="absolute left-4 top-1/2 transform -translate-y-1/2 bg-black/70 backdrop-blur-sm text-white rounded-full w-12 h-12 flex items-center justify-center hover:bg-black/90 hover:scale-110 transition-all duration-200 shadow-lg">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                  </svg>
                </button>
                
                <button 
                  *ngIf="selectedProduct.productVideos && selectedProduct.productVideos.length > 1"
                  (click)="nextVideo()"
                  class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-black/70 backdrop-blur-sm text-white rounded-full w-12 h-12 flex items-center justify-center hover:bg-black/90 hover:scale-110 transition-all duration-200 shadow-lg">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                  </svg>
                </button>

                <!-- Video Counter -->
                <div *ngIf="selectedProduct.productVideos && selectedProduct.productVideos.length > 1" 
                     class="absolute bottom-4 right-4 bg-black/70 backdrop-blur-sm text-white px-4 py-2 rounded-full text-sm font-medium">
                  {{currentVideoIndex + 1}} / {{selectedProduct.productVideos.length}}
                </div>

                <!-- Video indicator -->
                <div class="absolute top-4 right-4 bg-purple-500/90 backdrop-blur-sm text-white px-3 py-1 rounded-full text-xs font-medium">
                  üé• Video
                </div>
              </div>

              <!-- Video Thumbnail Strip -->
              <div *ngIf="selectedProduct.productVideos && selectedProduct.productVideos.length > 1" 
                   class="flex gap-3 overflow-x-auto pb-2">
                <button 
                  *ngFor="let video of selectedProduct.productVideos; let i = index"
                  (click)="goToVideo(i)"
                  [class.ring-4]="currentVideoIndex === i"
                  [class.ring-purple-500]="currentVideoIndex === i"
                  [class.scale-110]="currentVideoIndex === i"
                  class="flex-shrink-0 w-24 h-16 rounded-xl overflow-hidden border-2 border-transparent hover:border-purple-300 transition-all duration-200 shadow-md hover:shadow-lg bg-gray-100 flex items-center justify-center">
                  <svg class="w-8 h-8 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h8m2-10h.01M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                  </svg>
                </button>
              </div>
            </div>

            <!-- Fallback when no media -->
            <div *ngIf="(!selectedProduct.productImages?.length && !selectedProduct.productVideos?.length)" 
                 class="aspect-square bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl flex items-center justify-center">
              <div class="text-center text-gray-400">
                <svg class="w-16 h-16 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                </svg>
                <p class="text-lg font-medium">No media available</p>
                <p class="text-sm">This product has no images or videos</p>
              </div>
            </div>
          </div>

          <!-- Enhanced Product Details Section -->
          <div class="space-y-6">
            <!-- Product Header -->
            <div class="border-b border-gray-200 pb-6">
              <div class="flex items-start justify-between mb-4">
                <div>
                  <h3 class="text-3xl font-bold text-black leading-tight mb-2">{{selectedProduct.product_name}}</h3>
                  <!-- Brand Display -->
                  <div class="flex items-center gap-2">
                    <span class="text-sm text-gray-500 font-medium">Brand:</span>
                    <span class="bg-gray-100 text-gray-700 text-sm px-3 py-1 rounded-full font-medium">
                      {{ selectedProduct.brand_display }}
                    </span>
                  </div>
                </div>
              </div>
              <div class="flex items-center justify-between">
                <p class="text-4xl font-bold text-black">‚Ç±{{selectedProduct.price | number:'1.2-2'}}</p>
                <span [ngClass]="getSaleTypeBadgeClass(selectedProduct.saleType)" class="text-white text-sm px-4 py-2 rounded-full font-semibold shadow-lg">{{selectedProduct.saleType}}</span>
              </div>
            </div>

            <!-- Enhanced Product Info Grid -->
            <div class="grid grid-cols-2 gap-4">
              <div class="bg-white p-4 rounded-xl border border-gray-300">
                <p class="text-xs text-gray-600 font-medium uppercase tracking-wide">Category</p>
                <p class="font-bold text-black mt-1">{{selectedProduct.category}}</p>
              </div>
              <div class="bg-white p-4 rounded-xl border border-gray-300">
                <p class="text-xs text-gray-600 font-medium uppercase tracking-wide">Condition</p>
                <p class="font-bold text-black mt-1">{{selectedProduct.condition | titlecase}}</p>
              </div>
              <div class="bg-white p-4 rounded-xl border border-gray-300">
                <p class="text-xs text-gray-600 font-medium uppercase tracking-wide">Quantity</p>
                <p class="font-bold text-black mt-1">{{selectedProduct.quantity}} {{selectedProduct.quantity === 1 ? 'item' : 'items'}}</p>
              </div>
              <div class="bg-white p-4 rounded-xl border border-gray-300">
                <p class="text-xs text-gray-600 font-medium uppercase tracking-wide">Status</p>
                <p class="font-bold text-black mt-1">{{selectedProduct.sale_status | titlecase}}</p>
              </div>
            </div>

            <!-- Enhanced Description -->
            <div class="bg-gray-50 p-6 rounded-xl border border-gray-300">
              <h4 class="text-lg font-semibold text-black mb-3 flex items-center gap-2">
                <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
                Description
              </h4>
              <p class="text-gray-700 leading-relaxed break-words whitespace-pre-wrap overflow-wrap-anywhere max-w-full word-break">{{selectedProduct.description}}</p>
            </div>

            <!-- Product Specifications Table -->
            <div *ngIf="selectedProduct.specifications && selectedProduct.specifications.length > 0" 
                 class="bg-white p-6 rounded-xl border border-gray-300">
              <h4 class="text-lg font-semibold text-black mb-4 flex items-center gap-2">
                <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/>
                </svg>
                Specifications
              </h4>
              <!-- Specifications Table -->
              <div class="overflow-x-auto">
                <table class="w-full border-collapse">
                  <thead>
                    <tr class="border-b-2 border-gray-200">
                      <th class="text-left py-3 px-4 font-semibold text-gray-700 bg-gray-50 rounded-l-lg">Specification</th>
                      <th class="text-left py-3 px-4 font-semibold text-gray-700 bg-gray-50 rounded-r-lg">Value</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let spec of selectedProduct.specifications; let i = index" 
                        [class.bg-gray-50]="i % 2 === 1"
                        class="border-b border-gray-100 hover:bg-blue-50 transition-colors">
                      <td class="py-3 px-4 font-medium text-gray-800">{{spec.spec_name}}</td>
                      <td class="py-3 px-4 text-gray-700">{{spec.spec_value}}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <!-- Specifications Count Badge -->
              <div class="mt-3 flex justify-end">
                <span class="bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded-full">
                  {{selectedProduct.specifications.length}} specification{{selectedProduct.specifications.length !== 1 ? 's' : ''}}
                </span>
              </div>
            </div>

            <!-- Enhanced Seller Information & Action Buttons Combined -->
            <div class="flex flex-col lg:flex-row gap-6 pt-4">
              <!-- Enhanced Seller Information (Left Side - 60%) -->
              <div class="w-full lg:w-3/5 bg-white p-6 rounded-xl border border-gray-300">
                <h4 class="text-lg font-semibold text-black mb-4 flex items-center gap-2">
                  <svg class="w-5 h-5 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                  </svg>
                  Seller Information
                </h4>
                <div class="space-y-3">
                  <div class="flex items-center gap-3">
                    <img 
                      [src]="getProfileImageUrl(selectedProduct.seller_profile_image, selectedProduct.seller)" 
                      [alt]="selectedProduct.seller + ' profile'"
                      class="w-10 h-10 rounded-full object-cover border-2 border-gray-300 shadow-md"
                      (error)="$any($event.target).src = getProfileImageUrl(null, selectedProduct.seller)"
                    />
                    <div class="flex-1">
                      <p class="font-semibold text-black">{{selectedProduct.seller}}</p>
                      <p class="text-sm text-gray-600">Verified Seller</p>
                      
                      <!-- Seller Rating in Modal -->
                      <div class="flex items-center gap-2 mt-1">
                        <!-- Star Rating Display -->
                        <div class="flex items-center gap-1" *ngIf="selectedProduct.rating > 0">
                          <ng-container *ngFor="let star of getStarArray(selectedProduct.rating)">
                            <!-- Full Star -->
                            <svg *ngIf="star.type === 'full'" class="w-3 h-3 text-yellow-400" fill="currentColor" viewBox="0 0 24 24">
                              <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                            </svg>
                            <!-- Half Star -->
                            <div *ngIf="star.type === 'half'" class="relative w-3 h-3">
                              <svg class="absolute w-3 h-3 text-gray-300" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                              </svg>
                              <svg class="absolute w-3 h-3 text-yellow-400" fill="currentColor" viewBox="0 0 24 24" style="clip-path: inset(0 50% 0 0);">
                                <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                              </svg>
                            </div>
                            <!-- Empty Star -->
                            <svg *ngIf="star.type === 'empty'" class="w-3 h-3 text-gray-300" fill="currentColor" viewBox="0 0 24 24">
                              <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                            </svg>
                          </ng-container>
                        </div>
                        
                        <!-- No Rating Display -->
                        <div class="flex items-center text-gray-400" *ngIf="selectedProduct.rating === 0">
                          <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                          </svg>
                          <span class="text-xs">No ratings</span>
                        </div>
                        
                        <!-- Rating Value and Count -->
                        <div class="flex items-center gap-1" *ngIf="selectedProduct.rating > 0">
                          <span [ngClass]="getRatingColorClass(selectedProduct.rating)" class="text-xs font-medium">
                            {{ selectedProduct.rating | number:'1.1-1' }}
                          </span>
                          <span class="text-xs text-gray-500">
                            ({{ selectedProduct.totalRatings || 0 }} review{{ (selectedProduct.totalRatings || 0) !== 1 ? 's' : '' }})
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="flex items-center gap-3">
                    <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                    </svg>
                    <span class="text-gray-700 font-medium">{{selectedProduct.location}}</span>
                  </div>
                </div>
              </div>

              <!-- Enhanced Action Buttons (Right Side - 40%) -->
              <div class="w-full lg:w-2/5 flex flex-col gap-3 justify-center">
                <!-- Contact Seller Button (Primary) -->
                <button 
                  (click)="contactSeller(selectedProduct)"
                  class="w-full bg-black text-white py-3 px-6 rounded-xl hover:bg-gray-800 transition-all duration-200 font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 flex items-center justify-center gap-2">
                  <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                  </svg>
                  <div class="text-center leading-tight">
                    <div class="text-sm font-semibold">Message Seller</div>
                    <div class="text-xs opacity-75">Product details included</div>
                  </div>
                </button>

                <!-- View Seller Profile Button -->
                <button 
                  (click)="openProfileModal(selectedProduct)"
                  class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-xl transition-all duration-200 font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 flex items-center justify-center gap-2">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                  </svg>
                  <div class="text-center leading-tight">
                    <div class="text-sm font-semibold">View Profile</div>
                    <div class="text-xs opacity-75">Ratings & reviews</div>
                  </div>
                </button>

                <!-- Report Button (Secondary) -->
                <button 
                  (click)="openReportModal(selectedProduct, $event)"
                  class="w-full bg-gray-600 hover:bg-gray-700 text-white py-3 px-6 rounded-xl transition-all duration-200 font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 flex items-center justify-center gap-2">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                          d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.268 18.5c-.77.833.192 2.5 1.732 2.5z"/>
                    </svg>
                    Report Product
                  </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Report Modal -->
  <div *ngIf="showReportModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4"
       (click)="closeReportModal()">
    <div class="bg-white rounded-3xl max-w-2xl w-full max-h-[90vh] overflow-hidden shadow-2xl"
         (click)="$event.stopPropagation()">
      
      <!-- Report Modal Header -->
      <div class="flex items-center justify-between p-6 border-b border-gray-300 bg-black">
        <div class="flex items-center gap-3">
          <div class="p-2 bg-white/20 rounded-lg">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                    d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.268 18.5c-.77.833.192 2.5 1.732 2.5z"/>
            </svg>
          </div>
          <h2 class="text-2xl font-bold text-white">Report Product</h2>
        </div>
        <button 
          (click)="closeReportModal()"
          class="text-white/80 hover:text-white transition-colors p-2 hover:bg-white/10 rounded-lg">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>

      <!-- Report Modal Content -->
      <div class="overflow-y-auto max-h-[calc(90vh-120px)]">
        <app-reports 
          [isModal]="true"
          [prefilledProduct]="reportTargetProduct"
          (modalClosed)="closeReportModal()"
          (reportSubmitted)="onReportSubmitted($event)">
        </app-reports>
      </div>
    </div>
  </div>

  <!-- Alert Modal -->
  <div *ngIf="showAlertModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4"
       (click)="closeAlertModal()">
    <div class="bg-white rounded-3xl max-w-md w-full shadow-2xl"
         (click)="$event.stopPropagation()">
      
      <!-- Modal Header -->
      <div class="flex items-center justify-between p-6 border-b border-gray-200"
           [ngClass]="getAlertHeaderClass()">
        <div class="flex items-center gap-3">
          <div class="p-2 bg-white/20 rounded-lg">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" [attr.d]="getAlertIcon()"/>
            </svg>
          </div>
          <h2 class="text-xl font-bold text-white">{{ alertModalData.title }}</h2>
        </div>
        <button 
          (click)="closeAlertModal()"
          class="text-white/80 hover:text-white transition-colors p-2 hover:bg-white/10 rounded-lg">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>

      <!-- Modal Content -->
      <div class="p-6">
        <div class="flex items-start gap-4 mb-6">
          <div class="p-3 rounded-full"
               [ngClass]="getAlertIconBgClass()">
            <svg class="w-6 h-6" [ngClass]="getAlertIconClass()" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" [attr.d]="getAlertIcon()"/>
            </svg>
          </div>
          <div class="flex-1">
            <p class="text-gray-700 leading-relaxed">{{ alertModalData.message }}</p>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-col sm:flex-row gap-3 sm:justify-end">
          <button 
            *ngIf="alertModalData.showSecondaryButton"
            (click)="onAlertSecondaryAction()"
            class="px-6 py-2 rounded-xl border border-gray-300 text-gray-700 hover:bg-gray-50 transition-colors font-medium">
            {{ alertModalData.secondaryButtonText || 'Cancel' }}
          </button>
          <button 
            (click)="onAlertPrimaryAction()"
            class="px-6 py-2 rounded-xl font-medium transition-colors"
            [ngClass]="getAlertButtonClass()">
            {{ alertModalData.primaryButtonText || 'OK' }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Enhanced Profile Modal -->
  <div *ngIf="showProfileModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4"
       (click)="closeProfileModal()">
    <div class="bg-white rounded-3xl max-w-2xl w-full max-h-[90vh] shadow-2xl transform transition-all overflow-hidden"
         (click)="$event.stopPropagation()">
      
      <!-- Profile Modal Header -->
      <div class="flex items-center justify-between p-6 border-b border-gray-200 bg-black rounded-t-3xl">
        <div class="flex items-center gap-3">
          <div class="p-2 bg-white/20 rounded-lg">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
            </svg>
          </div>
          <h2 class="text-lg font-bold text-white">Seller Profile</h2>
        </div>
        <button 
          (click)="closeProfileModal()"
          class="text-white/80 hover:text-white transition-colors p-1.5 hover:bg-white/10 rounded-lg">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>

      <!-- Profile Modal Content -->
      <div *ngIf="selectedSellerProfile" class="overflow-y-auto max-h-[calc(90vh-100px)]">
        
        <!-- Top Section: Profile Info -->
        <div class="p-8 text-center bg-gradient-to-b from-gray-50 to-white">
          <!-- Profile Picture -->
          <div class="relative inline-block mb-4">
            <img 
              [src]="getProfileImageUrl(selectedSellerProfile.seller_profile_image, selectedSellerProfile.seller_name)" 
              [alt]="selectedSellerProfile.seller_name + ' profile'"
              class="w-32 h-32 rounded-full object-cover border-4 border-white shadow-xl mx-auto"
              (error)="$any($event.target).src = getProfileImageUrl(null, selectedSellerProfile.seller_name)"
            />
            <!-- Verification Badge -->
            <div *ngIf="selectedSellerProfile.is_verified" 
                 class="absolute -bottom-2 -right-2 bg-green-500 text-white rounded-full p-2 shadow-lg border-2 border-white">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
            </div>
          </div>
          
          <!-- Seller Name -->
          <h3 class="text-2xl font-bold text-black mb-2">{{ selectedSellerProfile.seller_name }}</h3>
          
          <!-- Verification Status -->
          <div class="flex items-center justify-center gap-2 mb-3">
            <div *ngIf="selectedSellerProfile.is_verified" class="flex items-center gap-1 text-green-600 bg-green-50 px-3 py-1 rounded-full">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
              <span class="text-sm font-medium">Verified User</span>
            </div>
            <div *ngIf="!selectedSellerProfile.is_verified" class="flex items-center gap-1 text-gray-500 bg-gray-100 px-3 py-1 rounded-full">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
              <span class="text-sm">Unverified User</span>
            </div>
          </div>
          
          <!-- Location -->
          <div *ngIf="selectedSellerProfile.city" class="flex items-center justify-center gap-2 text-gray-600 mb-4">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
            </svg>
            <span class="text-base font-medium">{{ selectedSellerProfile.city }}</span>
          </div>

          <!-- Rating Display -->
          <div class="bg-white rounded-2xl p-4 mb-4 shadow-md border border-gray-100">
            <!-- Loading State for Ratings -->
            <div *ngIf="selectedSellerProfile.loading" class="flex justify-center items-center py-6">
              <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
            </div>
            
            <!-- Rating Display -->
            <div *ngIf="!selectedSellerProfile.loading" class="text-center">
              <!-- Stars and Rating -->
              <div class="flex items-center justify-center gap-2 mb-2">
                <!-- Visual Stars -->
                <div class="flex items-center" *ngIf="selectedSellerProfile.average_rating > 0">
                  <ng-container *ngFor="let star of getStarArray(selectedSellerProfile.average_rating)">
                    <!-- Full Star -->
                    <svg *ngIf="star.type === 'full'" class="w-6 h-6 text-yellow-400" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                    </svg>
                    <!-- Half Star -->
                    <div *ngIf="star.type === 'half'" class="relative w-6 h-6">
                      <svg class="absolute w-6 h-6 text-gray-300" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                      </svg>
                      <svg class="absolute w-6 h-6 text-yellow-400" fill="currentColor" viewBox="0 0 24 24" style="clip-path: inset(0 50% 0 0);">
                        <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                      </svg>
                    </div>
                    <!-- Empty Star -->
                    <svg *ngIf="star.type === 'empty'" class="w-6 h-6 text-gray-300" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                    </svg>
                  </ng-container>
                </div>
                
                <!-- No Rating -->
                <div class="flex items-center text-gray-400" *ngIf="selectedSellerProfile.average_rating === 0">
                  <svg class="w-6 h-6 mr-1" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                  </svg>
                </div>
                
                <!-- Rating Value -->
                <span class="text-2xl font-bold text-black ml-2">
                  {{ selectedSellerProfile.average_rating > 0 ? (selectedSellerProfile.average_rating | number:'1.1-1') : 'No rating' }}
                </span>
              </div>
              
              <!-- Rating Details -->
              <div *ngIf="selectedSellerProfile.average_rating > 0" class="text-sm text-gray-600">
                <p>Based on {{ selectedSellerProfile.total_ratings }} review{{ selectedSellerProfile.total_ratings !== 1 ? 's' : '' }}</p>
              </div>
              <div *ngIf="selectedSellerProfile.average_rating === 0" class="text-sm text-gray-500">
                <p>No reviews yet</p>
              </div>
            </div>
          </div>

          <!-- Member Since -->
          <div class="flex items-center justify-center gap-2 text-gray-500 mb-6">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3a2 2 0 012-2h4a2 2 0 012 2v4m-6 2h6l1 9H7l1-9z"/>
            </svg>
            <span class="text-sm font-medium">Member since {{ formatMemberSince(selectedSellerProfile.created_at) }}</span>
          </div>
        </div>

        <!-- Action Buttons Section -->
        <div class="p-6 bg-white border-t border-gray-100">
          <div class="grid grid-cols-2 gap-4 mb-6">
            <!-- Reviews Button -->
            <button 
              (click)="switchProfileModalTab('reviews')"
              [class.bg-blue-600]="profileModalActiveTab === 'reviews'"
              [class.text-white]="profileModalActiveTab === 'reviews'"
              [class.bg-gray-100]="profileModalActiveTab !== 'reviews'"
              [class.text-gray-700]="profileModalActiveTab !== 'reviews'"
              [class.hover:bg-blue-700]="profileModalActiveTab === 'reviews'"
              [class.hover:bg-gray-200]="profileModalActiveTab !== 'reviews'"
              class="py-3 px-6 rounded-xl font-semibold transition-all duration-200 flex items-center justify-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
              </svg>
              <span>Reviews</span>
            </button>
            
            <!-- Other Products Button -->
            <button 
              (click)="switchProfileModalTab('listings')"
              [class.bg-orange-600]="profileModalActiveTab === 'listings'"
              [class.text-white]="profileModalActiveTab === 'listings'"
              [class.bg-gray-100]="profileModalActiveTab !== 'listings'"
              [class.text-gray-700]="profileModalActiveTab !== 'listings'"
              [class.hover:bg-orange-700]="profileModalActiveTab === 'listings'"
              [class.hover:bg-gray-200]="profileModalActiveTab !== 'listings'"
              class="py-3 px-6 rounded-xl font-semibold transition-all duration-200 flex items-center justify-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
              </svg>
              <span>Other Products</span>
            </button>
          </div>

          <!-- Dynamic Content Area -->
          <div class="min-h-[300px]">
            <!-- Reviews Tab Content -->
            <div *ngIf="profileModalActiveTab === 'reviews'">
              <!-- Loading Reviews -->
              <div *ngIf="loadingReviews" class="flex justify-center items-center py-12">
                <div class="text-center">
                  <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-3"></div>
                  <p class="text-gray-600">Loading reviews...</p>
                </div>
              </div>

              <!-- No Reviews -->
              <div *ngIf="!loadingReviews && sellerReviews.length === 0" class="text-center py-12">
                <div class="bg-gray-50 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
                  <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                  </svg>
                </div>
                <h3 class="text-lg font-semibold text-gray-800 mb-2">No Reviews Yet</h3>
                <p class="text-gray-600">This seller hasn't received any reviews from buyers.</p>
              </div>

              <!-- Reviews List -->
              <div *ngIf="!loadingReviews && sellerReviews.length > 0" class="space-y-4">
                <div *ngFor="let review of sellerReviews" class="bg-gray-50 rounded-xl p-4 border border-gray-100">
                  <!-- Review Header -->
                  <div class="flex items-start justify-between mb-3">
                    <div class="flex items-center gap-3">
                      <img 
                        [src]="getProfileImageUrl(review.reviewer_profile_image, review.reviewer_name)" 
                        [alt]="review.reviewer_name + ' profile'"
                        class="w-10 h-10 rounded-full object-cover border-2 border-white shadow-sm"
                        (error)="$any($event.target).src = getProfileImageUrl(null, review.reviewer_name)"
                      />
                      <div>
                        <p class="font-semibold text-gray-800">{{ review.reviewer_name }}</p>
                        <p class="text-sm text-gray-600">{{ formatReviewDate(review.created_at) }}</p>
                      </div>
                    </div>
                    <!-- Overall Rating -->
                    <div class="flex items-center gap-1">
                      <div class="flex items-center">
                        <ng-container *ngFor="let star of getStarArray(review.overall_rating)">
                          <svg *ngIf="star.type === 'full'" class="w-4 h-4 text-yellow-400" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                          </svg>
                          <svg *ngIf="star.type === 'empty'" class="w-4 h-4 text-gray-300" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                          </svg>
                        </ng-container>
                      </div>
                      <span class="text-sm font-medium text-gray-700 ml-1">{{ review.overall_rating | number:'1.1-1' }}</span>
                    </div>
                  </div>

                  <!-- Review Content -->
                  <div class="mb-3">
                    <p class="text-gray-700 leading-relaxed">{{ review.review_comment || 'No comment provided.' }}</p>
                  </div>

                  <!-- Product Info -->
                  <div *ngIf="review.product_name" class="bg-white rounded-lg p-3 border border-gray-200">
                    <div class="flex items-center gap-3">
                      <!-- Product Image -->
                      <img 
                        [src]="getReviewProductImage(review.product_images)"
                        [alt]="review.product_name"
                        class="w-12 h-12 rounded-lg object-cover border border-gray-200"
                        (error)="$any($event.target).src = 'https://via.placeholder.com/150x150/f3f4f6/9ca3af?text=No+Image'"
                      />
                      <div class="flex-1 min-w-0">
                        <p class="font-medium text-gray-800 truncate">{{ review.product_name }}</p>
                        <p class="text-sm text-gray-600">Product reviewed</p>
                        <span *ngIf="review.product_price" class="text-sm font-semibold text-green-600">‚Ç±{{ review.product_price | number:'1.0-0' }}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Other Products Tab Content -->
            <div *ngIf="profileModalActiveTab === 'listings'">
              <!-- Loading Other Products -->
              <div *ngIf="loadingOtherListings" class="flex justify-center items-center py-12">
                <div class="text-center">
                  <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-orange-600 mx-auto mb-3"></div>
                  <p class="text-gray-600">Loading products...</p>
                </div>
              </div>

              <!-- No Other Products -->
              <div *ngIf="!loadingOtherListings && sellerOtherListings.length === 0" class="text-center py-12">
                <div class="bg-gray-50 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
                  <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                  </svg>
                </div>
                <h3 class="text-lg font-semibold text-gray-800 mb-2">No Other Products</h3>
                <p class="text-gray-600">This seller doesn't have any other active products.</p>
              </div>

              <!-- Other Products Grid -->
              <div *ngIf="!loadingOtherListings && sellerOtherListings.length > 0">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                  <div *ngFor="let product of sellerOtherListings" 
                       class="bg-white rounded-xl border border-gray-200 overflow-hidden hover:shadow-lg transition-all duration-200 cursor-pointer group"
                       (click)="viewProductFromListings(product)">
                    <!-- Product Image -->
                    <div class="aspect-square bg-gray-100 overflow-hidden">
                      <img 
                        [src]="getImageUrl(getFirstProductImage(product.product_images))" 
                        [alt]="product.product_name"
                        class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                        (error)="$any($event.target).src = 'assets/placeholder-product.png'"
                      />
                    </div>
                    
                    <!-- Product Info -->
                    <div class="p-4">
                      <h4 class="font-semibold text-gray-800 mb-2 line-clamp-2">{{ product.product_name }}</h4>
                      <p class="text-lg font-bold text-black mb-2">‚Ç±{{ product.price | number:'1.2-2' }}</p>
                      <div class="flex items-center justify-between">
                        <span class="text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded-full">{{ product.category }}</span>
                        <div class="flex items-center gap-1 text-xs text-gray-500">
                          <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                          </svg>
                          <span>{{ getImageCount(product.product_images) }}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Message Seller Button -->
          <div class="mt-6 pt-4 border-t border-gray-100">
            <button 
              (click)="messageSellerFromProfile(selectedSellerProfile)"
              class="w-full bg-black text-white py-3 px-6 rounded-xl font-semibold transition-all duration-200 hover:bg-gray-800 flex items-center justify-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
              </svg>
              <span>Send Message</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Reviews Modal -->
  <div *ngIf="showReviewsModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4"
       (click)="closeReviewsModal()">
    <div class="bg-white rounded-3xl max-w-2xl w-full max-h-[90vh] shadow-2xl transform transition-all"
         (click)="$event.stopPropagation()">
      
      <!-- Reviews Modal Header -->
      <div class="flex items-center justify-between p-6 border-b border-gray-200 bg-black rounded-t-3xl">
        <div class="flex items-center gap-3">
          <div class="p-2 bg-white/20 rounded-lg">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
            </svg>
          </div>
          <div>
            <h2 class="text-lg font-bold text-white">Seller Reviews</h2>
            <p class="text-white/80 text-sm">{{ selectedSellerForReviews?.seller_name }}</p>
          </div>
        </div>
        <button 
          (click)="closeReviewsModal()"
          class="text-white/80 hover:text-white transition-colors p-1.5 hover:bg-white/10 rounded-lg">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>

      <!-- Reviews Modal Content -->
      <div class="overflow-y-auto max-h-[calc(90vh-120px)]">
        <div class="p-6">
          
          <!-- Loading State -->
          <div *ngIf="loadingReviews" class="flex justify-center items-center py-12">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-black"></div>
          </div>

          <!-- Reviews List -->
          <div *ngIf="!loadingReviews && sellerReviews.length > 0" class="space-y-4">
            <div *ngFor="let review of sellerReviews" class="bg-gray-50 rounded-2xl p-4 border border-gray-200">
              <div class="flex items-start gap-3">
                <!-- Reviewer Avatar -->
                <img 
                  [src]="getProfileImageUrl(review.reviewer_profile_image, review.reviewer_name)"
                  [alt]="review.reviewer_name + ' profile'"
                  class="w-10 h-10 rounded-full object-cover border border-gray-200"
                  (error)="$any($event.target).src = getProfileImageUrl(null, review.reviewer_name)"
                />
                
                <div class="flex-1">
                  <!-- Reviewer Info -->
                  <div class="flex items-center justify-between mb-2">
                    <h4 class="font-semibold text-black">{{ review.reviewer_name }}</h4>
                    <span class="text-xs text-gray-500">{{ formatReviewDate(review.created_at) }}</span>
                  </div>
                  
                  <!-- Rating Stars -->
                  <div class="flex items-center gap-1 mb-2">
                    <div class="flex items-center">
                      <span *ngFor="let star of [1,2,3,4,5]" 
                            [class]="star <= review.overall_rating ? 'text-yellow-500' : 'text-gray-300'">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                          <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                        </svg>
                      </span>
                    </div>
                    <span class="text-sm font-medium text-black ml-1">{{ review.overall_rating }}/5</span>
                  </div>
                  
                  <!-- Review Comment -->
                  <p *ngIf="review.review_comment" class="text-gray-700 text-sm mb-3">{{ review.review_comment }}</p>
                  <p *ngIf="!review.review_comment" class="text-gray-500 text-sm italic mb-3">No comment provided</p>
                  
                  <!-- Product Information -->
                  <div class="flex items-center gap-3 bg-white rounded-lg p-3 border border-gray-200">
                    <!-- Product Image -->
                    <img 
                      [src]="getReviewProductImage(review.product_images)"
                      [alt]="review.product_name"
                      class="w-12 h-12 rounded-lg object-cover border border-gray-200"
                      (error)="$any($event.target).src = 'https://via.placeholder.com/150x150/f3f4f6/9ca3af?text=No+Image'"
                    />
                    
                    <!-- Product Details -->
                    <div class="flex-1 min-w-0">
                      <h5 class="font-medium text-black text-sm truncate">{{ review.product_name }}</h5>
                      <p class="text-xs text-gray-500">Product reviewed</p>
                      <span *ngIf="review.product_price" class="text-sm font-semibold text-green-600">‚Ç±{{ review.product_price | number:'1.0-0' }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- No Reviews State -->
          <div *ngIf="!loadingReviews && sellerReviews.length === 0" class="text-center py-12">
            <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
              </svg>
            </div>
            <h3 class="text-lg font-semibold text-black mb-2">No Reviews Yet</h3>
            <p class="text-gray-500">This seller hasn't received any reviews from transactions.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>