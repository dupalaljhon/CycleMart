<div class="flex h-screen bg-theme-background">
  <!-- Admin Sidenav -->
  <app-admin-sidenav></app-admin-sidenav>

  <!-- Main Content -->
  <div class="flex-1 p-3 overflow-y-auto bg-theme-background">
    <!-- Ultra Compact Header -->
    <div class="mb-2">
      <div class="bg-white rounded-md p-2 mb-2 text-black shadow-sm border border-gray-200">
        <div class="flex justify-between items-center">
          <div>
            <h1 class="text-lg font-bold flex items-center gap-1">
              <mat-icon class="text-xl">inventory_2</mat-icon>
              Listing Monitoring
            </h1>
            <p class="text-gray-600 text-xs">Monitor and manage all product listings</p>
          </div>
          <div class="flex items-center gap-2">
            <div class="text-right">
              <div class="text-base font-bold">{{ dataSource.data.length }}</div>
              <div class="text-xs opacity-90">Total Products</div>
            </div>
            <button 
              (click)="refreshProducts()"
              class="bg-black bg-opacity-10 text-black px-3 py-1 rounded-sm hover:bg-gray-200 transition-all duration-200 flex items-center gap-1 border border-gray-300">
              <mat-icon class="text-xs">refresh</mat-icon>
              <span class="text-xs">Refresh</span>
            </button>
          </div>
        </div>
      </div>

      <!-- ðŸ” Search and Filters Section -->
      <div class="bg-white rounded-md shadow-sm p-3 mb-2 border border-gray-100">
        <div class="grid grid-cols-1 lg:grid-cols-5 gap-2 items-end">
          
          <!-- Section Header -->
          <div class="lg:col-span-5 mb-1">
            <div class="flex items-center gap-1">
              <mat-icon class="text-black text-xs">filter_list</mat-icon>
              <h3 class="text-sm font-semibold text-gray-800">Search & Filters</h3>
            </div>
          </div>

          <!-- Global Search -->
          <div class="lg:col-span-2">
            <mat-form-field appearance="fill" class="w-full">
              <mat-label class="text-xs">Search products</mat-label>
              <input 
                matInput 
                [(ngModel)]="searchTerm" 
                (input)="applyGlobalFilter()" 
                placeholder="Search by name, category, or seller"
                class="whitespace-nowrap overflow-hidden text-ellipsis text-sm"
              />
              <button matSuffix mat-icon-button aria-label="Search">
                <mat-icon class="text-gray-400 text-sm">search</mat-icon>
              </button>
            </mat-form-field>
          </div>

          <!-- Status Filter -->
          <div class="lg:col-span-1">
            <mat-form-field appearance="fill" class="w-full">
              <mat-label class="text-xs">Status</mat-label>
              <mat-select [(ngModel)]="statusFilter" (selectionChange)="onStatusFilterChange()">
                <mat-option value="all">All Status</mat-option>
                <mat-option value="active">Active</mat-option>
                <mat-option value="archived">Archived</mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <!-- Sale Status Filter -->
          <div class="lg:col-span-1">
            <mat-form-field appearance="fill" class="w-full">
              <mat-label class="text-xs">Sale Status</mat-label>
              <mat-select [(ngModel)]="saleStatusFilter" (selectionChange)="onSaleStatusFilterChange()">
                <mat-option value="all">All Sales</mat-option>
                <mat-option value="available">Available</mat-option>
                <mat-option value="sold">Sold</mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <!-- Product Type Filter -->
          <div class="lg:col-span-1">
            <mat-form-field appearance="fill" class="w-full">
              <mat-label class="text-xs">Product Type</mat-label>
              <mat-select [(ngModel)]="typeFilter" (selectionChange)="onTypeFilterChange()">
                <mat-option value="all">All Types</mat-option>
                <mat-option value="sale">For Sale</mat-option>
                <mat-option value="trade">For Trade</mat-option>
                <mat-option value="both">Both</mat-option>
              </mat-select>
            </mat-form-field>
          </div>

        </div>

        <!-- Quick Action Buttons -->
        <!-- <div class="flex flex-wrap gap-1 mt-1 pt-1 border-t border-gray-100">
          <button 
            (click)="clearFilters()"
            class="flex items-center gap-1 px-2 py-1 text-xs text-gray-600 hover:text-black hover:bg-gray-50 rounded-sm transition-colors">
            <mat-icon class="text-xs">clear_all</mat-icon>
            Clear Filters
          </button>
          <button 
            (click)="refreshProducts()"
            class="flex items-center gap-1 px-2 py-1 text-xs text-gray-600 hover:text-black hover:bg-gray-50 rounded-sm transition-colors">
            <mat-icon class="text-xs">refresh</mat-icon>
            Refresh Data
          </button>
        </div> -->
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="text-center py-12">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-black mx-auto"></div>
      <p class="mt-4 text-theme-secondary">Loading products...</p>
    </div>

    <!-- Enhanced Products Table -->
    <div *ngIf="!isLoading" class="bg-white rounded-xl shadow-lg overflow-hidden border border-gray-100">
      <!-- Table Header -->
      <!-- <div class="bg-white px-6 py-4 border-b border-gray-200">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-3">
            <mat-icon class="text-black">inventory_2</mat-icon>
            <h2 class="text-xl font-semibold text-black">Product Listings</h2>
          </div>
          <div class="text-black text-sm opacity-90">
            {{ dataSource.filteredData.length }} products displayed
          </div>
        </div>
      </div> -->

      <div class="overflow-x-auto">
        <table mat-table [dataSource]="dataSource" matSort class="w-full">
          
          <!-- Product Name Column -->
          <ng-container matColumnDef="product_name">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="bg-gray-50 text-gray-700 font-semibold p-4 border-b-2 border-gray-200">
              <div class="flex items-center gap-2">
                <mat-icon class="text-sm text-black">inventory_2</mat-icon>
                Product Details
              </div>
            </th>
            <td mat-cell *matCellDef="let product" class="p-4 border-b border-gray-100">
              <div class="flex items-center gap-4">
                <!-- Media Section -->
                <div class="flex gap-2">
                  <!-- Main Product Image -->
                  <div class="relative">
                    <img 
                      *ngIf="product.product_images && product.product_images.length > 0"
                      [src]="getImageUrl(product.product_images[0])" 
                      class="w-16 h-16 object-cover rounded-xl cursor-pointer hover:opacity-80 transition-all duration-200 shadow-md"
                      (click)="viewImages(product)"
                      alt="Product image">
                    <div 
                      *ngIf="!product.product_images || product.product_images.length === 0"
                      class="w-16 h-16 bg-gradient-to-br from-gray-100 to-gray-200 rounded-xl flex items-center justify-center shadow-md">
                      <mat-icon class="text-gray-400">image</mat-icon>
                    </div>
                    <div *ngIf="product.product_images && product.product_images.length > 1" 
                         class="absolute -top-1 -right-1 bg-black text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">
                      {{ product.product_images.length }}
                    </div>
                  </div>
                  
                  <!-- Video Thumbnail -->
                  <div class="relative" *ngIf="product.product_videos && product.product_videos.length > 0">
                    <div class="w-16 h-16 bg-gradient-to-br from-gray-100 to-gray-200 rounded-xl flex items-center justify-center shadow-md cursor-pointer hover:opacity-80 transition-all duration-200 hover:scale-105"
                         (click)="viewVideos(product)"
                         matTooltip="Click to view {{ product.product_videos.length }} video{{ product.product_videos.length > 1 ? 's' : '' }}"
                         matTooltipPosition="above">
                      <mat-icon class="text-black text-2xl">play_circle</mat-icon>
                    </div>
                    <div class="absolute -top-1 -right-1 bg-black text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">
                      {{ product.product_videos.length }}
                    </div>
                    <div class="absolute -bottom-1 left-1/2 transform -translate-x-1/2 bg-black text-white text-xs px-1 rounded">
                      ðŸŽ¥
                    </div>
                  </div>
                </div>
                
                <!-- Product Info -->
                <div class="flex-1 min-w-0">
                  <div class="font-semibold text-gray-900 truncate">{{ product.product_name }}</div>
                  <div class="text-sm text-gray-500 flex items-center gap-2 mt-1">
                    <mat-icon class="text-xs">inventory</mat-icon>
                    <span>{{ product.quantity }} available</span>
                    <span class="text-gray-300">â€¢</span>
                    <span class="capitalize">{{ product.category }}</span>
                  </div>
                  
                  <!-- Media Info -->
                  <div class="text-xs text-gray-400 flex items-center gap-3 mt-1">
                    <span *ngIf="product.product_images && product.product_images.length > 0" class="flex items-center gap-1">
                      <mat-icon class="text-xs">image</mat-icon>
                      {{ product.product_images.length }} image{{ product.product_images.length > 1 ? 's' : '' }}
                    </span>
                    <span *ngIf="product.product_videos && product.product_videos.length > 0" class="flex items-center gap-1">
                      <mat-icon class="text-xs">videocam</mat-icon>
                      {{ product.product_videos.length }} video{{ product.product_videos.length > 1 ? 's' : '' }}
                    </span>
                    <span *ngIf="hasMediaContent(product)" class="text-green-600 font-medium">
                      {{ getTotalMediaCount(product) }} total media files
                    </span>
                  </div>
                </div>
              </div>
            </td>
          </ng-container>

          <!-- Seller Column -->
          <ng-container matColumnDef="seller">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="bg-gray-50 text-gray-700 font-semibold p-4 border-b-2 border-gray-200">
              <div class="flex items-center gap-2">
                <mat-icon class="text-sm text-black">person</mat-icon>
                Seller Info
              </div>
            </th>
            <td mat-cell *matCellDef="let product" class="p-4 border-b border-gray-100">
              <div class="flex items-center gap-3">
                <img [src]="getSellerProfileImageUrl(product.seller_profile_image)" 
                     [alt]="product.seller_name || 'Seller'"
                     class="w-10 h-10 object-cover rounded-full border border-gray-200"
                     (error)="onSellerImageError($event)">
                <div>
                  <div class="font-medium text-gray-900">{{ product.seller_name || 'Unknown' }}</div>
                  <div class="text-sm text-gray-500">{{ product.seller_email || 'No email' }}</div>
                </div>
              </div>
            </td>
          </ng-container>

          <!-- Price Column -->
          <ng-container matColumnDef="price">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="bg-gray-50 text-gray-700 font-semibold p-4 border-b-2 border-gray-200">
              <div class="flex items-center gap-2">
                <mat-icon class="text-sm text-black">attach_money</mat-icon>
                Price
              </div>
            </th>
            <td mat-cell *matCellDef="let product" class="p-4 border-b border-gray-100">
              <div class="text-xl font-bold text-black">{{ formatPrice(product.price) }}</div>
              <div class="text-xs text-gray-500">{{ getForTypeText(product.for_type) }}</div>
            </td>
          </ng-container>

          <!-- Product Type Column -->
          <ng-container matColumnDef="for_type">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="bg-gray-50 text-gray-700 font-semibold p-4 border-b-2 border-gray-200">
              <div class="flex items-center gap-2">
                <mat-icon class="text-sm text-black">swap_horiz</mat-icon>
                Product Type
              </div>
            </th>
            <td mat-cell *matCellDef="let product" class="p-4 border-b border-gray-100">
              <div class="flex items-center gap-2">
                <div 
                  [class]="product.for_type === 'sale' ? 'bg-white text-black border-gray-300' : 
                           product.for_type === 'trade' ? 'bg-gray-200 text-black border-gray-400' : 
                           'bg-gray-400 text-black border-gray-500'"
                  class="px-3 py-1 rounded-full text-xs font-medium border flex items-center gap-1">
                  <mat-icon class="text-xs">
                    {{ product.for_type === 'sale' ? 'attach_money' : 
                       product.for_type === 'trade' ? 'swap_horiz' : 
                       'compare_arrows' }}
                  </mat-icon>
                  {{ getForTypeText(product.for_type) }}
                </div>
              </div>
            </td>
          </ng-container>

          <!-- Condition & Type Column -->
          <ng-container matColumnDef="condition">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="bg-gray-50 text-gray-700 font-semibold p-4 border-b-2 border-gray-200">
              <div class="flex items-center gap-2">
                <mat-icon class="text-sm text-black">verified</mat-icon>
                Condition
              </div>
            </th>
            <td mat-cell *matCellDef="let product" class="p-4 border-b border-gray-100">
              <div class="space-y-2">
                <div class="flex items-center gap-2">
                  <div 
                    [class]="product.condition === 'brand new' ? 'bg-white text-black border-gray-400' : 'bg-gray-200 text-black border-gray-400'"
                    class="px-3 py-1 rounded-full text-xs font-medium border">
                    {{ product.condition === 'brand new' ? 'Brand New' : 'Second Hand' }}
                  </div>
                </div>
              </div>
            </td>
          </ng-container>

          <!-- Status Column -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="bg-gray-50 text-gray-700 font-semibold p-4 border-b-2 border-gray-200">
              <div class="flex items-center gap-2">
                <mat-icon class="text-sm text-black">radio_button_checked</mat-icon>
                Status
              </div>
            </th>
            <td mat-cell *matCellDef="let product" class="p-4 border-b border-gray-100">
              <div class="space-y-2">
                <div class="flex items-center gap-2">
                  <div 
                    [class]="product.status === 'active' ? 'bg-white text-black border-gray-300' : 'bg-gray-800 text-white border-gray-500'"
                    class="px-3 py-1 rounded-full text-xs font-medium border flex items-center gap-1">
                    <mat-icon class="text-xs">
                      {{ product.status === 'active' ? 'check_circle' : 'archive' }}
                    </mat-icon>
                    {{ product.status | titlecase }}
                  </div>
                </div>
                <div class="flex items-center gap-2">
                  <div 
                    [class]="product.sale_status === 'available' ? 'bg-white text-black border-gray-300' : 'bg-gray-600 text-white border-gray-500'"
                    class="px-3 py-1 rounded-full text-xs font-medium border flex items-center gap-1">
                    <mat-icon class="text-xs">
                      {{ product.sale_status === 'available' ? 'shopping_cart' : 'done' }}
                    </mat-icon>
                    {{ getSaleStatusText(product) }}
                  </div>
                </div>
              </div>
            </td>
          </ng-container>

          <!-- Created At Column -->
          <ng-container matColumnDef="created_at">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="bg-gray-50 text-gray-700 font-semibold p-4 border-b-2 border-gray-200">
              <div class="flex items-center gap-2">
                <mat-icon class="text-sm text-black">schedule</mat-icon>
                Created
              </div>
            </th>
            <td mat-cell *matCellDef="let product" class="p-4 border-b border-gray-100">
              <div class="text-sm text-gray-600">{{ formatDate(product.created_at) }}</div>
              <div class="text-xs text-gray-400">{{ getTimeAgo(product.created_at) }}</div>
            </td>
          </ng-container>

          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef class="bg-gray-50 text-gray-700 font-semibold p-4 border-b-2 border-gray-200">
              <div class="flex items-center gap-2">
                <mat-icon class="text-sm text-black">settings</mat-icon>
                Actions
              </div>
            </th>
            <td mat-cell *matCellDef="let product" class="p-4 border-b border-gray-100">
              <div class="flex gap-2">
                <button 
                  *ngIf="product.product_images && product.product_images.length > 0"
                  mat-mini-fab
                  (click)="viewImages(product)"
                  class="!bg-white !text-black hover:!bg-gray-100 transition-colors !w-8 !h-8 !border !border-gray-300"
                  matTooltip="View Images">
                  <mat-icon class="!text-sm">visibility</mat-icon>
                </button>
                
                <button 
                  *ngIf="product.product_videos && product.product_videos.length > 0"
                  mat-mini-fab
                  (click)="viewVideos(product)"
                  class="!bg-white !text-black hover:!bg-gray-100 transition-colors !w-8 !h-8 !border !border-gray-300"
                  matTooltip="View Videos">
                  <mat-icon class="!text-sm">play_arrow</mat-icon>
                </button>
                
                <button 
                  mat-mini-fab
                  (click)="viewDescriptionSpecificationsReadOnly(product)"
                  class="!bg-white !text-black hover:!bg-gray-100 transition-colors !w-8 !h-8 !border !border-gray-300"
                  matTooltip="View Description & Specifications">
                  <mat-icon class="!text-sm">info</mat-icon>
                </button>
                
                <!-- <button 
                  mat-mini-fab
                  (click)="viewDescriptionSpecifications(product)"
                  class="!bg-white !text-black hover:!bg-gray-100 transition-colors !w-8 !h-8 !border !border-gray-300"
                  matTooltip="Edit Description & Specifications">
                  <mat-icon class="!text-sm">edit</mat-icon>
                </button> -->
                
                <button 
                  *ngIf="product.status === 'active'"
                  mat-mini-fab
                  (click)="archiveProduct(product)"
                  class="!bg-white !text-black hover:!bg-gray-100 transition-colors !w-8 !h-8 !border !border-gray-300"
                  matTooltip="Archive Product">
                  <mat-icon class="!text-sm">archive</mat-icon>
                </button>
                
                <button 
                  *ngIf="product.status === 'archived'"
                  mat-mini-fab
                  (click)="restoreProduct(product)"
                  class="!bg-white !text-black hover:!bg-gray-100 transition-colors !w-8 !h-8 !border !border-gray-300"
                  matTooltip="Restore Product">
                  <mat-icon class="!text-sm">unarchive</mat-icon>
                </button>
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;" 
              class="hover:bg-gray-50 transition-colors cursor-pointer border-b border-gray-50"></tr>
        </table>
      </div>

      <!-- Enhanced Paginator -->
      <div class="bg-gray-50 px-6 py-4 border-t border-gray-200">
        <mat-paginator 
          [pageSizeOptions]="[10, 25, 50, 100]" 
          [pageSize]="25"
          showFirstLastButtons
          class="!bg-transparent">
        </mat-paginator>
      </div>

      <!-- Enhanced No Data State -->
      <div *ngIf="dataSource.filteredData.length === 0 && !isLoading" class="text-center py-16 bg-gray-50">
        <div class="max-w-md mx-auto">
          <div class="w-24 h-24 bg-gradient-to-br from-gray-100 to-gray-200 rounded-full flex items-center justify-center mx-auto mb-6">
            <mat-icon class="text-4xl text-gray-400">search_off</mat-icon>
          </div>
          <h3 class="text-xl font-semibold text-gray-900 mb-2">No products found</h3>
          <p class="text-gray-500 mb-6" *ngIf="searchTerm || statusFilter !== 'all' || saleStatusFilter !== 'all'">
            Try adjusting your filters or search terms to find what you're looking for.
          </p>
          <p class="text-gray-500 mb-6" *ngIf="!searchTerm && statusFilter === 'all' && saleStatusFilter === 'all'">
            No products have been posted yet. Check back later for new listings.
          </p>
          <button 
            (click)="clearFilters()"
            class="bg-black text-white px-6 py-2 rounded-lg hover:bg-gray-800 transition-colors">
            Clear All Filters
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Image Preview Modal -->
  <div *ngIf="showImagePreview" class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-[9999]" 
       (click)="closeImagePreview()">
    <div class="relative w-full h-full flex items-center justify-center p-4">
      
      <!-- Close Button -->
      <button 
        (click)="closeImagePreview()"
        class="absolute top-4 right-4 z-10 bg-black bg-opacity-50 text-white rounded-full w-12 h-12 flex items-center justify-center hover:bg-opacity-70 transition-opacity">
        <mat-icon>close</mat-icon>
      </button>

      <!-- Product Info Header -->
      <div *ngIf="selectedProduct" class="absolute top-4 left-4 z-10 bg-black bg-opacity-50 text-white px-4 py-2 rounded-lg">
        <h3 class="font-semibold">{{ selectedProduct.product_name }}</h3>
        <p class="text-sm opacity-75">{{ currentImageIndex + 1 }} of {{ previewImages.length }}</p>
      </div>

      <!-- Main Image Container -->
      <div class="relative max-w-4xl max-h-full w-full h-full flex items-center justify-center"
           (click)="$event.stopPropagation()">
        
        <!-- Main Image -->
        <img 
          *ngIf="previewImages.length > 0"
          [src]="getImageUrl(previewImages[currentImageIndex])"
          class="max-w-full max-h-full object-contain"
          alt="Product image">

        <!-- Previous Button -->
        <button 
          *ngIf="previewImages.length > 1"
          (click)="prevImage()"
          class="absolute left-4 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 text-white rounded-full w-12 h-12 flex items-center justify-center hover:bg-opacity-70 transition-opacity">
          <mat-icon>chevron_left</mat-icon>
        </button>

        <!-- Next Button -->
        <button 
          *ngIf="previewImages.length > 1"
          (click)="nextImage()"
          class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 text-white rounded-full w-12 h-12 flex items-center justify-center hover:bg-opacity-70 transition-opacity">
          <mat-icon>chevron_right</mat-icon>
        </button>
      </div>

      <!-- Image Thumbnails -->
      <div *ngIf="previewImages.length > 1" class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex gap-2 bg-black bg-opacity-50 p-2 rounded-lg">
        <img 
          *ngFor="let image of previewImages; let i = index"
          [src]="getImageUrl(image)"
          (click)="currentImageIndex = i"
          class="w-16 h-16 object-cover rounded cursor-pointer transition-opacity"
          [class.opacity-50]="i !== currentImageIndex"
          [class.opacity-100]="i === currentImageIndex"
          alt="Thumbnail">
      </div>
    </div>
  </div>

  <!-- Video Preview Modal -->
  <div *ngIf="showVideoPreview" class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-[9999]" 
       (click)="closeVideoPreview()">
    <div class="relative w-full h-full flex items-center justify-center p-4">
      
      <!-- Close Button -->
      <button 
        (click)="closeVideoPreview()"
        class="absolute top-4 right-4 z-10 bg-black bg-opacity-50 text-white rounded-full w-12 h-12 flex items-center justify-center hover:bg-opacity-70 transition-opacity">
        <mat-icon>close</mat-icon>
      </button>

      <!-- Product Info Header -->
      <div *ngIf="selectedVideoProduct" class="absolute top-4 left-4 z-10 bg-black bg-opacity-50 text-white px-4 py-2 rounded-lg">
        <h3 class="font-semibold">{{ selectedVideoProduct.product_name }}</h3>
        <p class="text-sm opacity-75">{{ currentVideoIndex + 1 }} of {{ previewVideos.length }}</p>
        <p class="text-xs opacity-60" *ngIf="previewVideos[currentVideoIndex]">{{ getVideoType(previewVideos[currentVideoIndex]) }}</p>
      </div>

      <!-- Main Video Container -->
      <div class="relative max-w-4xl max-h-full w-full h-full flex items-center justify-center"
           (click)="$event.stopPropagation()">
        
        <!-- Main Video -->
        <div class="relative">
          <video 
            *ngIf="previewVideos.length > 0"
            [src]="getVideoUrl(previewVideos[currentVideoIndex])"
            class="max-w-full max-h-full rounded-lg shadow-2xl"
            controls
            autoplay
            preload="metadata">
            Your browser does not support the video tag.
          </video>
          
          <!-- Video Info Overlay -->
          <div class="absolute bottom-4 right-4 bg-black bg-opacity-60 text-white px-3 py-2 rounded-lg">
            <div class="text-sm font-medium">{{ getVideoType(previewVideos[currentVideoIndex]) }}</div>
            <div class="text-xs opacity-75">Click to play/pause</div>
          </div>
        </div>

        <!-- Previous Button -->
        <button 
          *ngIf="previewVideos.length > 1"
          (click)="prevVideo()"
          class="absolute left-4 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 text-white rounded-full w-12 h-12 flex items-center justify-center hover:bg-opacity-70 transition-opacity">
          <mat-icon>chevron_left</mat-icon>
        </button>

        <!-- Next Button -->
        <button 
          *ngIf="previewVideos.length > 1"
          (click)="nextVideo()"
          class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 text-white rounded-full w-12 h-12 flex items-center justify-center hover:bg-opacity-70 transition-opacity">
          <mat-icon>chevron_right</mat-icon>
        </button>
      </div>

      <!-- Video Thumbnails -->
      <div *ngIf="previewVideos.length > 1" class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex gap-2 bg-black bg-opacity-50 p-2 rounded-lg">
        <button 
          *ngFor="let video of previewVideos; let i = index"
          (click)="currentVideoIndex = i"
          class="w-16 h-16 bg-gray-700 rounded cursor-pointer transition-all duration-200 flex flex-col items-center justify-center relative"
          [class.opacity-50]="i !== currentVideoIndex"
          [class.opacity-100]="i === currentVideoIndex"
          [class.ring-2]="i === currentVideoIndex"
          [class.ring-purple-400]="i === currentVideoIndex">
          <mat-icon class="text-white text-lg">play_arrow</mat-icon>
          <span class="text-white text-xs">{{ i + 1 }}</span>
          <div class="absolute bottom-0 left-0 right-0 bg-black bg-opacity-60 text-white text-xs px-1 py-0.5 rounded-b">
            {{ getVideoExtension(video).toUpperCase() }}
          </div>
        </button>
      </div>
    </div>
  </div>

  <!-- Archive Product Modal -->
  <div *ngIf="showArchiveModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[9999] p-4"
       (click)="closeArchiveModal()">
    <div class="bg-white rounded-xl max-w-md w-full overflow-hidden shadow-2xl transform transition-all"
         (click)="$event.stopPropagation()">
      
      <!-- Modal Header -->
      <div class="flex items-center justify-between p-4 border-b border-gray-200 bg-gradient-to-r from-red-500 to-red-600">
        <div class="flex items-center gap-2">
          <div class="p-1.5 bg-white/20 rounded-lg">
            <mat-icon class="text-white">archive</mat-icon>
          </div>
          <h2 class="text-lg font-bold text-white">Archive Product</h2>
        </div>
        <button 
          (click)="closeArchiveModal()"
          class="text-white/80 hover:text-white transition-colors p-1.5 hover:bg-white/10 rounded-lg">
          <mat-icon>close</mat-icon>
        </button>
      </div>

      <!-- Modal Content -->
      <div class="p-6">
        <div *ngIf="productToArchive" class="mb-4">
          <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
            <img 
              *ngIf="productToArchive.product_images && productToArchive.product_images.length > 0"
              [src]="getImageUrl(productToArchive.product_images[0])" 
              class="w-12 h-12 object-cover rounded-lg"
              alt="Product image">
            <div 
              *ngIf="!productToArchive.product_images || productToArchive.product_images.length === 0"
              class="w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center">
              <mat-icon class="text-gray-400">image</mat-icon>
            </div>
            <div class="flex-1">
              <h3 class="font-semibold text-gray-900">{{ productToArchive.product_name }}</h3>
              <p class="text-sm text-gray-500">{{ productToArchive.category }}</p>
            </div>
          </div>
        </div>

        <div class="mb-4">
          <mat-form-field appearance="fill" class="w-full">
            <mat-label>Reason for archiving</mat-label>
            <textarea 
              matInput 
              [(ngModel)]="archiveReason"
              placeholder="Please provide a detailed reason for archiving this product..."
              rows="3"
              required>
            </textarea>
          </mat-form-field>
        </div>

        <!-- Modal Actions -->
        <div class="flex flex-col sm:flex-row gap-3 sm:gap-4">
          <button 
            (click)="closeArchiveModal()"
            class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 px-6 py-3 rounded-lg transition-all duration-200 font-semibold text-center">
            Cancel
          </button>
          <button 
            (click)="confirmArchive()"
            [disabled]="!archiveReason.trim()"
            class="flex-1 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 disabled:opacity-50 disabled:cursor-not-allowed text-white px-6 py-3 rounded-lg transition-all duration-200 font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 text-center">
            Archive Product
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Restore Product Modal -->
  <div *ngIf="showRestoreModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[9999] p-4"
       (click)="closeRestoreModal()">
    <div class="bg-white rounded-xl max-w-md w-full overflow-hidden shadow-2xl transform transition-all"
         (click)="$event.stopPropagation()">
      
      <!-- Modal Header -->
      <div class="flex items-center justify-between p-4 border-b border-gray-200 bg-gradient-to-r from-green-500 to-green-600">
        <div class="flex items-center gap-2">
          <div class="p-1.5 bg-white/20 rounded-lg">
            <mat-icon class="text-white">unarchive</mat-icon>
          </div>
          <h2 class="text-lg font-bold text-white">Restore Product</h2>
        </div>
        <button 
          (click)="closeRestoreModal()"
          class="text-white/80 hover:text-white transition-colors p-1.5 hover:bg-white/10 rounded-lg">
          <mat-icon>close</mat-icon>
        </button>
      </div>

      <!-- Modal Content -->
      <div class="p-6">
        <div *ngIf="productToRestore" class="mb-4">
          <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
            <img 
              *ngIf="productToRestore.product_images && productToRestore.product_images.length > 0"
              [src]="getImageUrl(productToRestore.product_images[0])" 
              class="w-12 h-12 object-cover rounded-lg"
              alt="Product image">
            <div 
              *ngIf="!productToRestore.product_images || productToRestore.product_images.length === 0"
              class="w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center">
              <mat-icon class="text-gray-400">image</mat-icon>
            </div>
            <div class="flex-1">
              <h3 class="font-semibold text-gray-900">{{ productToRestore.product_name }}</h3>
              <p class="text-sm text-gray-500">{{ productToRestore.category }}</p>
            </div>
          </div>
        </div>

        <div class="mb-4">
          <mat-form-field appearance="fill" class="w-full">
            <mat-label>Reason for restoring</mat-label>
            <textarea 
              matInput 
              [(ngModel)]="restoreReason"
              placeholder="Please provide a detailed reason for restoring this product..."
              rows="3"
              required>
            </textarea>
          </mat-form-field>
        </div>

        <!-- Modal Actions -->
        <div class="flex flex-col sm:flex-row gap-3 sm:gap-4">
          <button 
            (click)="closeRestoreModal()"
            class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 px-6 py-3 rounded-lg transition-all duration-200 font-semibold text-center">
            Cancel
          </button>
          <button 
            (click)="confirmRestore()"
            [disabled]="!restoreReason.trim()"
            class="flex-1 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 disabled:opacity-50 disabled:cursor-not-allowed text-white px-6 py-3 rounded-lg transition-all duration-200 font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 text-center">
            Restore Product
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Description & Specifications Modal -->
  <div *ngIf="showDescriptionModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[9999] p-4"
       (click)="closeDescriptionModal()">
    <div class="bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-hidden shadow-2xl transform transition-all"
         (click)="$event.stopPropagation()">
      
      <!-- Modal Header -->
      <div class="flex items-center justify-between p-6 border-b border-gray-200 bg-gradient-to-r from-blue-500 to-blue-600">
        <div class="flex items-center gap-3">
          <mat-icon class="text-white text-2xl">description</mat-icon>
          <div>
            <h3 class="text-xl font-semibold text-white">Description & Specifications</h3>
            <p class="text-blue-100 text-sm" *ngIf="selectedDescriptionProduct">{{ selectedDescriptionProduct.product_name }}</p>
          </div>
        </div>
        <button 
          (click)="closeDescriptionModal()"
          class="text-white hover:bg-white/20 rounded-full p-2 transition-colors">
          <mat-icon>close</mat-icon>
        </button>
      </div>

      <!-- Modal Content -->
      <div class="p-6 overflow-y-auto max-h-[calc(90vh-200px)]">
        <form *ngIf="selectedDescriptionProduct" class="space-y-6">
          
          <!-- Product Info Summary -->
          <div class="bg-gray-50 rounded-lg p-4 mb-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div>
                <label class="text-sm font-medium text-gray-600">Product Name</label>
                <p class="text-gray-900 font-semibold">{{ selectedDescriptionProduct.product_name }}</p>
              </div>
              <div>
                <label class="text-sm font-medium text-gray-600">Price</label>
                <p class="text-gray-900 font-semibold">{{ formatPrice(selectedDescriptionProduct.price) }}</p>
              </div>
              <div>
                <label class="text-sm font-medium text-gray-600">Seller</label>
                <p class="text-gray-900 font-semibold">{{ selectedDescriptionProduct.seller_name }}</p>
              </div>
            </div>
          </div>

          <!-- Description Section -->
          <div class="space-y-3">
            <label class="block text-sm font-medium text-gray-700">
              <mat-icon class="mr-2 text-blue-600 align-middle">subject</mat-icon>
              Product Description
            </label>
            <textarea 
              [(ngModel)]="editDescription"
              name="description"
              rows="5"
              class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-vertical"
              placeholder="Enter product description...">
            </textarea>
            <p class="text-sm text-gray-500">Provide a detailed description of the product.</p>
          </div>

          <!-- Specifications Section -->
          <div class="space-y-4">
            <div class="flex items-center justify-between">
              <label class="block text-sm font-medium text-gray-700">
                <mat-icon class="mr-2 text-green-600 align-middle">build</mat-icon>
                Product Specifications
              </label>
              <button 
                type="button"
                (click)="addSpecification()"
                class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded-lg text-sm font-medium transition-colors flex items-center gap-1">
                <mat-icon class="text-sm">add</mat-icon>
                Add Spec
              </button>
            </div>
            
            <div class="space-y-3">
              <div *ngFor="let spec of editSpecifications; let i = index" 
                   class="flex gap-3 items-center bg-gray-50 p-3 rounded-lg">
                <div class="flex-1">
                  <input 
                    [(ngModel)]="spec.spec_name"
                    name="spec_name_{{i}}"
                    type="text"
                    placeholder="Specification name (e.g., Frame Material)"
                    class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div class="flex-1">
                  <input 
                    [(ngModel)]="spec.spec_value"
                    name="spec_value_{{i}}"
                    type="text"
                    placeholder="Specification value (e.g., Carbon Fiber)"
                    class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                <button 
                  type="button"
                  (click)="removeSpecification(i)"
                  class="bg-red-500 hover:bg-red-600 text-white p-2 rounded-md transition-colors">
                  <mat-icon class="text-sm">delete</mat-icon>
                </button>
              </div>
              
              <div *ngIf="editSpecifications.length === 0" class="text-center py-8 text-gray-500">
                <mat-icon class="text-4xl mb-2 opacity-50">build</mat-icon>
                <p>No specifications added yet</p>
                <p class="text-sm">Click "Add Spec" to add product specifications</p>
              </div>
            </div>
          </div>

        </form>
      </div>

      <!-- Modal Footer -->
      <div class="flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50">
        <div class="text-sm text-gray-600">
          <mat-icon class="mr-1 text-sm align-middle">info</mat-icon>
          Changes will be saved to the product database
        </div>
        <div class="flex gap-3">
          <button 
            (click)="closeDescriptionModal()"
            class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-6 py-2 rounded-lg transition-all duration-200 font-semibold">
            Cancel
          </button>
          <button 
            (click)="saveDescriptionSpecifications()"
            [disabled]="isUpdatingDescription"
            class="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white px-6 py-2 rounded-lg transition-all duration-200 font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 flex items-center gap-2">
            <mat-icon *ngIf="isUpdatingDescription" class="animate-spin text-sm">refresh</mat-icon>
            <span>{{ isUpdatingDescription ? 'Saving...' : 'Save Changes' }}</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- View-Only Description & Specifications Modal -->
  <div *ngIf="showViewOnlyModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[9999] p-4"
       (click)="closeViewOnlyModal()">
    <div class="bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-hidden shadow-2xl transform transition-all"
         (click)="$event.stopPropagation()">
      
      <!-- Modal Header -->
      <div class="flex items-center justify-between p-6 border-b border-gray-200 bg-gradient-to-r from-green-500 to-green-600">
        <div class="flex items-center gap-3">
          <mat-icon class="text-white text-2xl">info</mat-icon>
          <div>
            <h3 class="text-xl font-semibold text-white">Product Details</h3>
            <p class="text-green-100 text-sm" *ngIf="selectedViewProduct">{{ selectedViewProduct.product_name }}</p>
          </div>
        </div>
        <button 
          (click)="closeViewOnlyModal()"
          class="text-white hover:bg-white/20 rounded-full p-2 transition-colors">
          <mat-icon>close</mat-icon>
        </button>
      </div>

      <!-- Modal Content -->
      <div class="p-6 overflow-y-auto max-h-[calc(90vh-150px)]">
        <div *ngIf="selectedViewProduct" class="space-y-6">
          
          <!-- Product Info Summary -->
          <div class="bg-gray-50 rounded-lg p-4 mb-6">
            <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
              <mat-icon class="mr-2 text-blue-600">inventory_2</mat-icon>
              Product Information
            </h4>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
              <div>
                <label class="text-sm font-medium text-gray-600">Product Name</label>
                <p class="text-gray-900 font-semibold">{{ selectedViewProduct.product_name }}</p>
              </div>
              <div>
                <label class="text-sm font-medium text-gray-600">Price</label>
                <p class="text-gray-900 font-semibold">{{ formatPrice(selectedViewProduct.price) }}</p>
              </div>
              <div>
                <label class="text-sm font-medium text-gray-600">Seller</label>
                <p class="text-gray-900 font-semibold">{{ selectedViewProduct.seller_name }}</p>
              </div>
              <div>
                <label class="text-sm font-medium text-gray-600">Brand</label>
                <p class="text-gray-900 font-semibold">{{ selectedViewProduct.brand_name || 'No Brand' }}</p>
              </div>
              <div>
                <label class="text-sm font-medium text-gray-600">Condition</label>
                <p class="text-gray-900 font-semibold capitalize">{{ selectedViewProduct.condition.replace('_', ' ') }}</p>
              </div>
              <div>
                <label class="text-sm font-medium text-gray-600">Category</label>
                <p class="text-gray-900 font-semibold capitalize">{{ selectedViewProduct.category.replace('_', ' ') }}</p>
              </div>
              <div>
                <label class="text-sm font-medium text-gray-600">For Type</label>
                <p class="text-gray-900 font-semibold capitalize">{{ getForTypeText(selectedViewProduct.for_type) }}</p>
              </div>
              <div>
                <label class="text-sm font-medium text-gray-600">Quantity</label>
                <p class="text-gray-900 font-semibold">{{ selectedViewProduct.quantity }}</p>
              </div>
              <div>
                <label class="text-sm font-medium text-gray-600">Location</label>
                <p class="text-gray-900 font-semibold">{{ selectedViewProduct.location }}</p>
              </div>
            </div>
          </div>

          <!-- Description Section -->
          <div class="space-y-3">
            <h4 class="text-lg font-semibold text-gray-800 flex items-center">
              <mat-icon class="mr-2 text-blue-600">subject</mat-icon>
              Product Description
            </h4>
            <div class="bg-white border border-gray-200 rounded-lg p-4">
              <p class="text-gray-700 whitespace-pre-wrap" [innerHTML]="selectedViewProduct.description || 'No description provided.'"></p>
            </div>
          </div>

          <!-- Specifications Section -->
          <div class="space-y-4">
            <h4 class="text-lg font-semibold text-gray-800 flex items-center">
              <mat-icon class="mr-2 text-green-600">build</mat-icon>
              Product Specifications
            </h4>
            
            <div *ngIf="selectedViewProduct.specifications && selectedViewProduct.specifications.length > 0; else noSpecs">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div *ngFor="let spec of selectedViewProduct.specifications" 
                     class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                  <div class="flex flex-col space-y-2">
                    <label class="text-sm font-medium text-gray-600">{{ spec.spec_name || spec.name }}</label>
                    <p class="text-gray-900 font-semibold">{{ spec.spec_value || spec.value }}</p>
                  </div>
                </div>
              </div>
            </div>
            
            <ng-template #noSpecs>
              <div class="text-center py-8 text-gray-500 bg-gray-50 rounded-lg border border-gray-200">
                <mat-icon class="text-4xl mb-2 opacity-50">build</mat-icon>
                <p class="text-lg font-medium">No specifications available</p>
                <p class="text-sm">This product doesn't have any specifications listed.</p>
              </div>
            </ng-template>
          </div>

        </div>
      </div>

      <!-- Modal Footer -->
      <div class="flex items-center justify-end p-6 border-t border-gray-200 bg-gray-50">
        <button 
          (click)="closeViewOnlyModal()"
          class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg transition-all duration-200 font-semibold">
          Close
        </button>
      </div>
    </div>
  </div>

</div>

